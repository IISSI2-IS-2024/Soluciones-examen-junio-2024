{"ast":null,"code":"import _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport AsyncStorage from '@react-native-async-storage/async-storage';\nimport axios from 'axios';\nimport * as SecureStore from 'expo-secure-store';\nimport React, { createContext, useState, useContext } from 'react';\nimport Platform from \"react-native-web/dist/exports/Platform\";\nimport { isTokenValid, login, register, update } from \"../api/AuthEndpoints\";\nimport { AppContext } from \"../context/AppContext\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nvar AuthorizationContext = createContext();\nvar AuthorizationContextProvider = function AuthorizationContextProvider(props) {\n  var _useContext = useContext(AppContext),\n    setLoading = _useContext.setLoading,\n    setError = _useContext.setError,\n    processError = _useContext.processError;\n  var _useState = useState(null),\n    _useState2 = _slicedToArray(_useState, 2),\n    loggedInUser = _useState2[0],\n    setLoggedInUser = _useState2[1];\n  var signOut = function signOut() {\n    var onSuccess = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : null;\n    var onError = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;\n    try {\n      setLoggedInUser(null);\n      if (Platform.OS === 'ios' || Platform.OS === 'android') {\n        SecureStore.deleteItemAsync('user');\n      } else {\n        AsyncStorage.removeItem('user');\n      }\n      if (onSuccess) {\n        onSuccess();\n      }\n    } catch (err) {\n      if (onError) {\n        onError();\n      }\n    }\n  };\n  var signUp = function () {\n    var _ref = _asyncToGenerator(function* (data) {\n      var onSuccess = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;\n      var onError = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;\n      try {\n        var registeredUser = yield register(data);\n        axios.defaults.headers.common = {\n          Authorization: \"bearer \" + registeredUser.token\n        };\n        setLoggedInUser(registeredUser);\n        if (Platform.OS === 'ios' || Platform.OS === 'android') {\n          SecureStore.setItemAsync('user', JSON.stringify(registeredUser));\n        } else {\n          AsyncStorage.setItem('user', JSON.stringify(registeredUser));\n        }\n        if (onSuccess) {\n          onSuccess(registeredUser);\n        }\n      } catch (error) {\n        processError(error, onError, 'register');\n      }\n    });\n    return function signUp(_x) {\n      return _ref.apply(this, arguments);\n    };\n  }();\n  var updateProfile = function () {\n    var _ref2 = _asyncToGenerator(function* (data) {\n      var onSuccess = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;\n      var onError = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;\n      try {\n        var updatedUser = yield update(data);\n        setLoggedInUser(updatedUser);\n        if (Platform.OS === 'ios' || Platform.OS === 'android') {\n          SecureStore.setItemAsync('user', JSON.stringify(updatedUser));\n        } else {\n          AsyncStorage.setItem('user', JSON.stringify(updatedUser));\n        }\n        if (onSuccess) {\n          onSuccess(updatedUser);\n        }\n      } catch (error) {\n        processError(error, onError, 'updateProfile');\n      }\n    });\n    return function updateProfile(_x2) {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n  var signIn = function () {\n    var _ref3 = _asyncToGenerator(function* (data) {\n      var onSuccess = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;\n      var onError = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;\n      try {\n        var _loggedInUser = yield login(data);\n        axios.defaults.headers.common = {\n          Authorization: \"bearer \" + _loggedInUser.token\n        };\n        setLoggedInUser(_loggedInUser);\n        if (Platform.OS === 'ios' || Platform.OS === 'android') {\n          SecureStore.setItemAsync('user', JSON.stringify(_loggedInUser));\n        } else {\n          AsyncStorage.setItem('user', JSON.stringify(_loggedInUser));\n        }\n        if (onSuccess) {\n          onSuccess(_loggedInUser);\n        }\n      } catch (error) {\n        processError(error, onError, 'login');\n      }\n    });\n    return function signIn(_x3) {\n      return _ref3.apply(this, arguments);\n    };\n  }();\n  var getToken = function () {\n    var _ref4 = _asyncToGenerator(function* () {\n      var onSuccess = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : null;\n      var onError = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;\n      setLoading(true);\n      try {\n        var user;\n        if (Platform.OS === 'ios' || Platform.OS === 'android') {\n          user = yield SecureStore.getItemAsync('user');\n        } else {\n          user = yield AsyncStorage.getItem('user');\n        }\n        if (user) {\n          try {\n            user = JSON.parse(user);\n            var returnedUser = yield isTokenValid(user.token);\n            axios.defaults.headers.common = {\n              Authorization: \"bearer \" + returnedUser.token\n            };\n            setLoggedInUser(returnedUser);\n            if (onSuccess) {\n              onSuccess(returnedUser);\n            }\n          } catch (err) {\n            signOut();\n            if (onError) {\n              onError(err);\n            }\n          }\n        }\n      } catch (err) {\n        setError(err);\n        if (onError) {\n          onError(err);\n        }\n      } finally {\n        setLoading(false);\n      }\n    });\n    return function getToken() {\n      return _ref4.apply(this, arguments);\n    };\n  }();\n  return _jsx(AuthorizationContext.Provider, {\n    value: {\n      loggedInUser: loggedInUser,\n      signIn: signIn,\n      signOut: signOut,\n      signUp: signUp,\n      getToken: getToken,\n      updateProfile: updateProfile\n    },\n    children: props.children\n  });\n};\nexport { AuthorizationContext };\nexport default AuthorizationContextProvider;","map":{"version":3,"names":["AsyncStorage","axios","SecureStore","React","createContext","useState","useContext","isTokenValid","login","register","update","AppContext","AuthorizationContext","AuthorizationContextProvider","props","setLoading","setError","processError","loggedInUser","setLoggedInUser","signOut","onSuccess","onError","Platform","OS","deleteItemAsync","removeItem","err","signUp","data","registeredUser","defaults","headers","common","Authorization","token","setItemAsync","JSON","stringify","setItem","error","updateProfile","updatedUser","signIn","getToken","user","getItemAsync","getItem","parse","returnedUser","children"],"sources":["/Users/luismi/Proyectos/Examenes/DeliverUS-Frontend-Owner/src/context/AuthorizationContext.js"],"sourcesContent":["// Alternativa que funciona en web menos segura\nimport AsyncStorage from '@react-native-async-storage/async-storage'\nimport axios from 'axios'\nimport * as SecureStore from 'expo-secure-store'\nimport React, { createContext, useState, useContext } from 'react'\nimport { Platform } from 'react-native'\nimport { isTokenValid, login, register, update } from '../api/AuthEndpoints'\nimport { AppContext } from '../context/AppContext'\n\nconst AuthorizationContext = createContext()\n\nconst AuthorizationContextProvider = props => {\n  const { setLoading, setError, processError } = useContext(AppContext)\n  const [loggedInUser, setLoggedInUser] = useState(null)\n\n  const signOut = (onSuccess = null, onError = null) => {\n    try {\n      setLoggedInUser(null)\n      if (Platform.OS === 'ios' || Platform.OS === 'android') {\n        SecureStore.deleteItemAsync('user')\n      } else {\n        AsyncStorage.removeItem('user')\n      }\n      if (onSuccess) { onSuccess() }\n    } catch (err) {\n      if (onError) { onError() }\n    }\n  }\n  const signUp = async (data, onSuccess = null, onError = null) => {\n    try {\n      const registeredUser = await register(data)\n      axios.defaults.headers.common = { Authorization: `bearer ${registeredUser.token}` }\n      setLoggedInUser(registeredUser)\n      if (Platform.OS === 'ios' || Platform.OS === 'android') {\n        SecureStore.setItemAsync('user', JSON.stringify(registeredUser))\n      } else {\n        AsyncStorage.setItem('user', JSON.stringify(registeredUser))\n      }\n      if (onSuccess) { onSuccess(registeredUser) }\n    } catch (error) {\n      processError(error, onError, 'register')\n    }\n  }\n\n  const updateProfile = async (data, onSuccess = null, onError = null) => {\n    try {\n      const updatedUser = await update(data)\n      setLoggedInUser(updatedUser)\n      if (Platform.OS === 'ios' || Platform.OS === 'android') {\n        SecureStore.setItemAsync('user', JSON.stringify(updatedUser))\n      } else {\n        AsyncStorage.setItem('user', JSON.stringify(updatedUser))\n      }\n      if (onSuccess) { onSuccess(updatedUser) }\n    } catch (error) {\n      processError(error, onError, 'updateProfile')\n    }\n  }\n\n  const signIn = async (data, onSuccess = null, onError = null) => {\n    try {\n      const loggedInUser = await login(data)\n      axios.defaults.headers.common = { Authorization: `bearer ${loggedInUser.token}` }\n      setLoggedInUser(loggedInUser)\n      if (Platform.OS === 'ios' || Platform.OS === 'android') {\n        SecureStore.setItemAsync('user', JSON.stringify(loggedInUser))\n      } else {\n        AsyncStorage.setItem('user', JSON.stringify(loggedInUser))\n      }\n      if (onSuccess) {\n        onSuccess(loggedInUser)\n      }\n    } catch (error) {\n      processError(error, onError, 'login')\n    }\n  }\n  const getToken = async (onSuccess = null, onError = null) => {\n    setLoading(true)\n    try {\n      let user\n      if (Platform.OS === 'ios' || Platform.OS === 'android') {\n        user = await SecureStore.getItemAsync('user')\n      } else {\n        user = await AsyncStorage.getItem('user')\n      }\n      if (user) {\n        try {\n          user = JSON.parse(user)\n          const returnedUser = await isTokenValid(user.token)\n          axios.defaults.headers.common = { Authorization: `bearer ${returnedUser.token}` }\n          setLoggedInUser(returnedUser)\n          if (onSuccess) { onSuccess(returnedUser) }\n        } catch (err) {\n          signOut()\n          if (onError) {\n            onError(err)\n          }\n        }\n      }\n    } catch (err) {\n      setError(err)\n      if (onError) { onError(err) }\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  return (\n    <AuthorizationContext.Provider value={{\n      loggedInUser,\n      signIn,\n      signOut,\n      signUp,\n      getToken,\n      updateProfile\n    }}\n    >\n      {props.children}\n    </AuthorizationContext.Provider>\n  )\n}\n\nexport { AuthorizationContext }\nexport default AuthorizationContextProvider\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}